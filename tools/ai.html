<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ø¨Ø²Ø§Ø± ØªØ´Ø®ÛŒØµ Ø­Ø±Ú©Øª</title>

<style>
body {
    margin: 0;
    background: #000;
    color: #00ffcc;
    font-family: Tahoma, Arial, sans-serif;
    text-align: center;
}

header {
    padding: 20px 10px;
    border-bottom: 1px solid #00ffcc;
}

h1 {
    margin: 0;
    font-size: 24px;
}

.section {
    border: 1px solid #00ffcc;
    margin: 20px auto;
    padding: 15px;
    max-width: 420px;
}

video, canvas {
    width: 100%;
    border: 1px solid #00ffcc;
    margin-top: 10px;
}

button {
    background: #000;
    color: #00ffcc;
    border: 1px solid #00ffcc;
    padding: 10px 20px;
    font-size: 15px;
    margin-top: 10px;
}

button:hover {
    background: #00ffcc;
    color: #000;
}

#status {
    margin-top: 15px;
    font-size: 18px;
}

.alert {
    color: red;
    font-weight: bold;
}

.guide {
    font-size: 14px;
    color: #aaa;
    line-height: 1.8;
    text-align: right;
}
</style>
</head>

<body>

<header>
    <h1>ğŸ“· Ø§Ø¨Ø²Ø§Ø± ØªØ´Ø®ÛŒØµ Ø­Ø±Ú©Øª</h1>
    <p style="color:#aaa;">Ø§Ø¬Ø±Ø§ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± â€¢ Ø¨Ø¯ÙˆÙ† Ù†ØµØ¨</p>
</header>

<div class="section guide">
    <strong>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡:</strong><br>
    1ï¸âƒ£ Ø¯Ú©Ù…Ù‡ Â«Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ±Ø¨ÛŒÙ†Â» Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯<br>
    2ï¸âƒ£ Ú¯ÙˆØ´ÛŒ Ø±Ø§ Ø«Ø§Ø¨Øª Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯<br>
    3ï¸âƒ£ Ø¨Ø§ ØªØ´Ø®ÛŒØµ Ø­Ø±Ú©ØªØŒ Ù‡Ø´Ø¯Ø§Ø± ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
</div>

<div class="section">
    <button id="startBtn">â–¶ Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ±Ø¨ÛŒÙ†</button>

    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <div id="status">ÙˆØ¶Ø¹ÛŒØª: ØºÛŒØ±ÙØ¹Ø§Ù„</div>
</div>

<audio id="alarm">
    <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const statusText = document.getElementById("status");
const alarm = document.getElementById("alarm");

let lastFrame = null;
let motionThreshold = 25;

document.getElementById("startBtn").onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" },
        audio: false
    });
    video.srcObject = stream;
    statusText.textContent = "ÙˆØ¶Ø¹ÛŒØª: Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø§ÛŒØ´...";
    requestAnimationFrame(detectMotion);
};

function detectMotion() {
    if (video.videoWidth === 0) {
        requestAnimationFrame(detectMotion);
        return;
    }

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    ctx.drawImage(video, 0, 0);
    const currentFrame = ctx.getImageData(0, 0, canvas.width, canvas.height);

    if (lastFrame) {
        let diff = 0;
        for (let i = 0; i < currentFrame.data.length; i += 4) {
            diff += Math.abs(currentFrame.data[i] - lastFrame.data[i]);
        }

        if (diff / currentFrame.data.length > motionThreshold) {
            statusText.innerHTML = "ğŸš¨ Ø­Ø±Ú©Øª ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯!";
            statusText.className = "alert";
            alarm.play();
        } else {
            statusText.textContent = "ÙˆØ¶Ø¹ÛŒØª: Ø¨Ø¯ÙˆÙ† Ø­Ø±Ú©Øª";
            statusText.className = "";
        }
    }

    lastFrame = currentFrame;
    requestAnimationFrame(detectMotion);
}
</script>

</body>
</html>
