<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Human Detection</title>
    <style>body{margin:0;background:#000;overflow:hidden}video,canvas{position:absolute;width:100%;height:100%;object-fit:cover}</style>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl@3.18.0/dist/tf-backend-webgl.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@2.0.0/dist/pose-detection.js"></script>
</head>
<body>
    <video id="video" playsinline muted autoplay></video>
    <canvas id="canvas"></canvas>
    <script>
        async function start() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'},audio:false});
            video.srcObject = stream;
            await new Promise(r => video.onloadedmetadata = r);
            video.play();
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            await tf.ready();
            const detector = await poseDetection.createDetector(poseDetection.SupportedModels.MoveNet, {modelType: poseDetection.movenet.modelType.SINGLEPOSE_LIGHTNING});
            
            async function render() {
                if(canvas.width !== video.videoWidth) { canvas.width = video.videoWidth; canvas.height = video.videoHeight; }
                const poses = await detector.estimatePoses(video);
                ctx.clearRect(0,0,canvas.width,canvas.height);
                poses.forEach(pose => {
                    pose.keypoints.forEach(k => {
                        if(k.score > 0.3) {
                            ctx.beginPath(); ctx.arc(k.x, k.y, 5, 0, 2*Math.PI);
                            ctx.fillStyle='aqua'; ctx.fill();
                        }
                    });
                });
                requestAnimationFrame(render);
            }
            render();
        }
        start();
    </script>
</body>
</html>